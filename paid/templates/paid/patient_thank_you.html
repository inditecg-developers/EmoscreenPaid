{% extends "content/base.html" %}
{% block content %}
<h2>Thank you</h2>
<div class="card">
  <p>Your response has been submitted.</p>

  {% if regenerated %}<p><strong>Reports regenerated with latest template.</strong></p>{% endif %}
  <p><a class="btn" href="?refresh=1">Regenerate Latest Reports</a></p>

  {% if report %}
    <p><strong>Debug downloads:</strong></p>
    <p>
      <a class="btn" href="{% url 'paid:download_report' order.order_code 'patient' %}">Download Patient Report</a>
      <a class="btn" href="{% url 'paid:download_report' order.order_code 'doctor' %}">Download Doctor Report</a>
    </p>
    <p><strong>Patient PDF password (debug):</strong> {{ patient_password }}</p>
    <p><strong>Doctor PDF password (debug):</strong> {{ doctor_password }}</p>
  {% else %}
    <p>Report is not generated yet.</p>
  {% endif %}

  <hr />
  <h3>Email delivery logs (latest)</h3>
  {% if email_logs %}
    <table>
      <thead>
        <tr>
          <th>Time</th><th>Type</th><th>To</th><th>Status</th><th>Message ID</th><th>Error</th>
        </tr>
      </thead>
      <tbody>
        {% for log in email_logs %}
          <tr>
            <td>{{ log.created_at }}</td>
            <td>{{ log.email_type }}</td>
            <td>{{ log.to_email }}</td>
            <td>{{ log.status }}</td>
            <td>{{ log.sendgrid_message_id|default:'-' }}</td>
            <td style="max-width:320px;word-break:break-word">{{ log.error_text|default:'-' }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No paid email logs found for this order yet.</p>
  {% endif %}
</div>
{% endblock %}
